////////////////////////////////////////////////////////////////////////////////
////////////////// M E M O R Y   D E T A C H E R  //////////////////////////////
////////////////////////////////////////////////////////////////////////////////
#include <stdio.h>
#include <stdlib.h>
#include <sys/types.h>
#include <sys/shm.h>
#include "myRecordDef.h"
#include <time.h>
#include <semaphore.h>
#include <sys/ipc.h>

int main(int argc,char *argv[])
{
////////////////////////////////////////////////////////////////////////////////
////////// V A R I A B L E S   D E C L A R A T I O N    ////////////////////////
////////////////////////////////////////////////////////////////////////////////
	int memid,semid;
	int err=0,i;
	sem_t *spna,*spnw,*spc;
	int * glbv;
////////////////////////////////////////////////////////////////////////////////
//////////////    S T O R E   T H E   V A R I A B L E S           //////////////
////////////////////////////////////////////////////////////////////////////////
if(argc==5)
{
	for(i=1;i<argc;i++)
	{
		if(!strcmp(argv[i],"-s"))
		{
			memid=atoi(argv[i+1]);
			printf(" \n MEMORY IDENTIFICATION TO BE FREE : %d \n",memid);
		}
		else if(!strcmp(argv[i],"-p"))
		{
			semid=atoi(argv[i+1]);
			printf(" \n SEMAPHORE MEMORY IDENTIFICATION TO BE FREE : %d \n",semid);
		}
	}
}
else
{
	printf("Correct syntax is: %s -s number_of_memory_id -p number_of_semaphore_memory_id \n", argv[0]);
	return(1);
}
////////////////////////////////////////////////////////////////////////////////
////////// S E T  S E M A P H O R E S  M E M O R Y  P O S I T I O N S  /////////
////////////////////////////////////////////////////////////////////////////////
	spna  = (sem_t *) shmat(semid,(void*) 0, 0);
	spnw  = (sem_t *) (spna+sizeof(sem_t));
	spc  = (sem_t *) (spnw+sizeof(sem_t));
	glbv = (int *)	 (spc+sizeof(int));
////////////////////////////////////////////////////////////////////////////////
//////////       D E S T R O Y  S E M A P H O R E S     ////////////////////////
////////////////////////////////////////////////////////////////////////////////

	sem_destroy(spc);
	sem_destroy(spnw);
	sem_destroy(spna);

////////////////////////////////////////////////////////////////////////////////
//////////  R E M O V E   S E M A P H O R E  S E G M E N T  ////////////////////
////////////////////////////////////////////////////////////////////////////////
	err = shmctl(semid, IPC_RMID, 0);
	if (err == -1)
		perror ("Removal.");
	else
		printf("Removed. %d\n", (int)(err));


////////////////////////////////////////////////////////////////////////////////
//////////  R E M O V E  R E C O R D  S E G M E N T   //////////////////////////
////////////////////////////////////////////////////////////////////////////////
	/* Remove segment */
	err = shmctl(memid, IPC_RMID, 0);
	if (err == -1)
		perror ("Removal.");
	else
		printf("Removed. %d\n", (int)(err));

	return 0;
}
